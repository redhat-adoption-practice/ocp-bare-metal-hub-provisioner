- name: Wait for RHCOS to come up
  wait_for_connection:
    delay: 120
    timeout: 600

- name: Wait five minutes to ensure rpm-ostree is ready
  wait_for:
    timeout: 300

- name: Deploy HPE Tools Repo Config
  become: true
  template:
    src: hpe-repos.j2
    dest: /etc/yum.repos.d/hpe.repo

- name: Install packages via rpm-ostree
  become: true
  shell: "rpm-ostree install {{ hpe_tools_packages|join(' ') }}"

- name: Reboot server
  reboot:
    reboot_timeout: 1200
  become: true
